{
  "name": "Simple WhatsApp Drive Assistant",
  "active": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "whatsapp-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-node",
      "name": "ğŸ“± WhatsApp Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [200, 400],
      "notes": "Receives WhatsApp messages from Twilio"
    },
    {
      "parameters": {
        "jsCode": "// ğŸ” Parse WhatsApp Command\nconst body = $input.first().json.Body?.trim() || '';\nconst from = $input.first().json.From || '';\nconst userPhone = from.replace('whatsapp:', '');\n\n// Parse command structure\nconst parts = body.split(' ');\nconst command = parts[0]?.toUpperCase() || '';\nconst path = parts[1] || '';\nconst destination = parts[2] || '';\n\n// Log for audit\nconsole.log(`Command received: ${command} from ${userPhone}`);\n\nreturn {\n  command,\n  path,\n  destination,\n  userPhone,\n  originalMessage: body,\n  timestamp: new Date().toISOString()\n};"
      },
      "id": "parse-command",
      "name": "ğŸ” Parse Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [400, 400],
      "notes": "Extracts command, path, and parameters from WhatsApp message"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "id": "list-cmd",
              "leftValue": "={{ $json.command }}",
              "rightValue": "LIST",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "delete-cmd",
              "leftValue": "={{ $json.command }}",
              "rightValue": "DELETE",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "move-cmd",
              "leftValue": "={{ $json.command }}",
              "rightValue": "MOVE",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "summary-cmd",
              "leftValue": "={{ $json.command }}",
              "rightValue": "SUMMARY",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "help-cmd",
              "leftValue": "={{ $json.command }}",
              "rightValue": "HELP",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        }
      },
      "id": "command-router",
      "name": "ğŸ¯ Command Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [600, 400],
      "notes": "Routes to appropriate handler based on command"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "list",
        "folderId": {
          "__rl": true,
          "value": "={{ $json.path === '/' || !$json.path ? 'root' : $json.path }}",
          "mode": "id"
        },
        "options": {
          "fields": "files(id,name,mimeType,size,modifiedTime,parents,webViewLink)"
        }
      },
      "id": "drive-list",
      "name": "ğŸ“ List Drive Files",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [800, 200],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google-drive-creds",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "Lists files in specified Google Drive folder"
    },
    {
      "parameters": {
        "jsCode": "// ğŸ“ Format File List Response\nconst files = $input.all();\nconst folderPath = $('ğŸ” Parse Command').first().json.path || '/';\nconst userPhone = $('ğŸ” Parse Command').first().json.userPhone;\n\nif (!files.length) {\n  return {\n    response: `ğŸ“ Folder '${folderPath}' is empty or not found.`,\n    userPhone,\n    action: 'LIST',\n    status: 'empty'\n  };\n}\n\nlet response = `ğŸ“ *Contents of '${folderPath}':*\\n\\n`;\n\nfiles.forEach((file, index) => {\n  const item = file.json;\n  const icon = item.mimeType?.includes('folder') ? 'ğŸ“' : 'ğŸ“„';\n  const size = item.size ? ` (${Math.round(item.size / 1024)}KB)` : '';\n  const date = new Date(item.modifiedTime).toLocaleDateString();\n  \n  response += `${icon} *${item.name}*${size}\\n`;\n  response += `   ğŸ“… ${date}\\n\\n`;\n});\n\nresponse += `\\nğŸ“Š Total: ${files.length} items`;\n\nreturn {\n  response,\n  userPhone,\n  action: 'LIST',\n  status: 'success',\n  fileCount: files.length\n};"
      },
      "id": "format-list",
      "name": "ğŸ“ Format List Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1000, 200],
      "notes": "Formats file list into readable WhatsApp message"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "delete",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.path }}",
          "mode": "id"
        }
      },
      "id": "drive-delete",
      "name": "ğŸ—‘ï¸ Delete Drive File",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [800, 300],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google-drive-creds",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "Deletes specified file from Google Drive"
    },
    {
      "parameters": {
        "jsCode": "// ğŸ—‘ï¸ Format Delete Response\nconst userPhone = $('ğŸ” Parse Command').first().json.userPhone;\nconst filePath = $('ğŸ” Parse Command').first().json.path;\nconst fileName = filePath.split('/').pop();\n\nreturn {\n  response: `âœ… *File Deleted Successfully*\\n\\nğŸ—‘ï¸ '${fileName}' has been permanently deleted from Google Drive.\\n\\nâš ï¸ This action cannot be undone.`,\n  userPhone,\n  action: 'DELETE',\n  status: 'success',\n  fileName\n};"
      },
      "id": "format-delete",
      "name": "ğŸ—‘ï¸ Format Delete Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1000, 300],
      "notes": "Formats delete confirmation message"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "update",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.path }}",
          "mode": "id"
        },
        "options": {
          "parents": "={{ $json.destination }}"
        }
      },
      "id": "drive-move",
      "name": "ğŸ“¦ Move Drive File",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [800, 400],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google-drive-creds",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "Moves file to different Google Drive folder"
    },
    {
      "parameters": {
        "jsCode": "// ğŸ“¦ Format Move Response\nconst userPhone = $('ğŸ” Parse Command').first().json.userPhone;\nconst sourcePath = $('ğŸ” Parse Command').first().json.path;\nconst destination = $('ğŸ” Parse Command').first().json.destination;\nconst fileName = sourcePath.split('/').pop();\n\nreturn {\n  response: `âœ… *File Moved Successfully*\\n\\nğŸ“¦ '${fileName}' has been moved to:\\nğŸ“ ${destination}\\n\\nğŸ“ Action logged for audit.`,\n  userPhone,\n  action: 'MOVE',\n  status: 'success',\n  fileName,\n  destination\n};"
      },
      "id": "format-move",
      "name": "ğŸ“¦ Format Move Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1000, 400],
      "notes": "Formats move confirmation message"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "list",
        "folderId": {
          "__rl": true,
          "value": "={{ $json.path === '/' || !$json.path ? 'root' : $json.path }}",
          "mode": "id"
        },
        "options": {
          "fields": "files(id,name,mimeType,size)",
          "q": "mimeType='application/pdf' or mimeType='application/vnd.openxmlformats-officedocument.wordprocessingml.document' or mimeType='text/plain'"
        }
      },
      "id": "drive-get-docs",
      "name": "ğŸ“„ Get Documents for Summary",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [800, 500],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google-drive-creds",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "Gets PDF, DOCX, and TXT files for summarization"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        }
      },
      "id": "drive-download",
      "name": "â¬‡ï¸ Download Document",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [1000, 500],
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "google-drive-creds",
          "name": "Google Drive OAuth2"
        }
      },
      "notes": "Downloads document content for AI processing"
    },
    {
      "parameters": {
        "model": "gpt-4",
        "messages": {
          "messages": [
            {
              "role": "system",
              "content": "You are a document summarization assistant. Create concise bullet-point summaries of documents. Focus on key points, main topics, and important conclusions. Keep summaries under 150 words per document."
            },
            {
              "role": "user",
              "content": "=Summarize this document content in bullet points:\n\nFilename: {{ $('ğŸ“„ Get Documents for Summary').first().json.name }}\n\nContent:\n{{ $json.data }}"
            }
          ]
        },
        "options": {
          "temperature": 0.3,
          "maxTokens": 200
        }
      },
      "id": "ai-summarize",
      "name": "ğŸ¤– AI Summarize",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1200, 500],
      "credentials": {
        "openAiApi": {
          "id": "openai-creds",
          "name": "OpenAI API"
        }
      },
      "notes": "Uses GPT-4 to create document summaries"
    },
    {
      "parameters": {
        "jsCode": "// ğŸ¤– Format Summary Response\nconst summaries = $input.all();\nconst folderPath = $('ğŸ” Parse Command').first().json.path || '/';\nconst userPhone = $('ğŸ” Parse Command').first().json.userPhone;\n\nif (!summaries.length) {\n  return {\n    response: `ğŸ“„ No summarizable documents found in '${folderPath}'.\\n\\nSupported formats: PDF, DOCX, TXT`,\n    userPhone,\n    action: 'SUMMARY',\n    status: 'no_docs'\n  };\n}\n\nlet response = `ğŸ“„ *Document Summaries for '${folderPath}':*\\n\\n`;\n\nsummaries.forEach((summary, index) => {\n  const content = summary.json.choices[0].message.content;\n  const fileName = $('ğŸ“„ Get Documents for Summary').all()[index].json.name;\n  \n  response += `ğŸ“ *${fileName}:*\\n${content}\\n\\n`;\n});\n\nresponse += `\\nğŸ¤– Generated by AI - Please verify important details.`;\n\nreturn {\n  response,\n  userPhone,\n  action: 'SUMMARY',\n  status: 'success',\n  documentCount: summaries.length\n};"
      },
      "id": "format-summary",
      "name": "ğŸ“ Format Summary Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1400, 500],
      "notes": "Formats AI summaries into readable WhatsApp message"
    },
    {
      "parameters": {
        "jsCode": "// â“ Help Command Response\nconst userPhone = $json.userPhone;\n\nconst helpText = `ğŸ¤– *WhatsApp Drive Assistant*\\n\\n*Available Commands:*\\n\\nğŸ“ *LIST /folder* - List files\\n   Example: LIST /ProjectX\\n\\nğŸ—‘ï¸ *DELETE /path/file.pdf* - Delete file\\n   Example: DELETE /ProjectX/report.pdf\\n\\nğŸ“¦ *MOVE /source /destination* - Move file\\n   Example: MOVE /ProjectX/file.pdf /Archive\\n\\nğŸ“„ *SUMMARY /folder* - AI summaries\\n   Example: SUMMARY /ProjectX\\n\\nâ“ *HELP* - Show this menu\\n\\nâš ï¸ *Security:* All actions are logged for audit.`;\n\nreturn {\n  response: helpText,\n  userPhone,\n  action: 'HELP',\n  status: 'success'\n};"
      },
      "id": "help-response",
      "name": "â“ Help Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [800, 600],
      "notes": "Provides help menu with available commands"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "={{ $vars.AUDIT_SHEET_ID }}",
          "mode": "id"
        },
        "sheetName": "AuditLog",
        "columnToMatchOn": "A",
        "valueToMatchOn": "={{ $json.timestamp }}",
        "options": {
          "cellFormat": "USER_ENTERED",
          "useAppend": true
        },
        "fieldsUi": {
          "values": [
            {
              "column": "A",
              "value": "={{ $json.timestamp }}"
            },
            {
              "column": "B", 
              "value": "={{ $json.userPhone }}"
            },
            {
              "column": "C",
              "value": "={{ $json.action }}"
            },
            {
              "column": "D",
              "value": "={{ $json.path || $json.fileName || 'N/A' }}"
            },
            {
              "column": "E",
              "value": "={{ $json.status }}"
            },
            {
              "column": "F",
              "value": "={{ $json.response?.slice(0, 100) || 'Action completed' }}"
            }
          ]
        }
      },
      "id": "audit-log",
      "name": "ğŸ“Š Audit Log",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1200, 300],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-creds",
          "name": "Google Sheets OAuth2"
        }
      },
      "notes": "Logs all actions to Google Sheets for audit trail"
    },
    {
      "parameters": {
        "account": "={{ $vars.TWILIO_ACCOUNT_SID }}",
        "authToken": "={{ $vars.TWILIO_AUTH_TOKEN }}",
        "fromPhoneNumber": "={{ $vars.TWILIO_PHONE_NUMBER }}",
        "toPhoneNumber": "={{ $json.userPhone }}",
        "message": "={{ $json.response }}"
      },
      "id": "send-whatsapp",
      "name": "ğŸ“± Send WhatsApp Response",
      "type": "n8n-nodes-base.twilio",
      "typeVersion": 1,
      "position": [1400, 350],
      "credentials": {
        "twilioApi": {
          "id": "twilio-creds",
          "name": "Twilio Account"
        }
      },
      "notes": "Sends response back to user via WhatsApp"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{ \"status\": \"success\", \"message\": \"Command processed\" }"
      },
      "id": "webhook-response",
      "name": "âœ… Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1600, 400],
      "notes": "Responds to Twilio webhook with success status"
    },
    {
      "parameters": {
        "jsCode": "// âš ï¸ Error Handler\nconst error = $input.first().json.error || 'Unknown error occurred';\nconst userPhone = $('ğŸ” Parse Command').first()?.json?.userPhone || '';\nconst command = $('ğŸ” Parse Command').first()?.json?.command || 'UNKNOWN';\n\nconsole.error(`Error processing ${command}:`, error);\n\nreturn {\n  response: `âŒ *Error Processing Command*\\n\\nCommand: ${command}\\nError: ${error.message || error}\\n\\nTry: HELP for available commands`,\n  userPhone,\n  action: command,\n  status: 'error',\n  error: error.message || error\n};"
      },
      "id": "error-handler",
      "name": "âš ï¸ Error Handler",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1000, 700],
      "notes": "Handles errors and sends user-friendly error messages"
    }
  ],
  "connections": {
    "ğŸ“± WhatsApp Webhook": {
      "main": [
        [
          {
            "node": "ğŸ” Parse Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Parse Command": {
      "main": [
        [
          {
            "node": "ğŸ¯ Command Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ Command Router": {
      "main": [
        [
          {
            "node": "ğŸ“ List Drive Files",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ—‘ï¸ Delete Drive File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“¦ Move Drive File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ğŸ“„ Get Documents for Summary",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "â“ Help Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ List Drive Files": {
      "main": [
        [
          {
            "node": "ğŸ“ Format List Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Format List Response": {
      "main": [
        [
          {
            "node": "ğŸ“Š Audit Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ—‘ï¸ Delete Drive File": {
      "main": [
        [
          {
            "node": "ğŸ—‘ï¸ Format Delete Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ—‘ï¸ Format Delete Response": {
      "main": [
        [
          {
            "node": "ğŸ“Š Audit Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¦ Move Drive File": {
      "main": [
        [
          {
            "node": "ğŸ“¦ Format Move Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¦ Format Move Response": {
      "main": [
        [
          {
            "node": "ğŸ“Š Audit Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“„ Get Documents for Summary": {
      "main": [
        [
          {
            "node": "â¬‡ï¸ Download Document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â¬‡ï¸ Download Document": {
      "main": [
        [
          {
            "node": "ğŸ¤– AI Summarize",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– AI Summarize": {
      "main": [
        [
          {
            "node": "ğŸ“ Format Summary Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Format Summary Response": {
      "main": [
        [
          {
            "node": "ğŸ“Š Audit Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â“ Help Response": {
      "main": [
        [
          {
            "node": "ğŸ“Š Audit Log",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“Š Audit Log": {
      "main": [
        [
          {
            "node": "ğŸ“± Send WhatsApp Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“± Send WhatsApp Response": {
      "main": [
        [
          {
            "node": "âœ… Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-08-03T05:00:00.000Z",
  "versionId": "1"
}